---
data:
  _extendedDependsOn:
  - icon: ':heavy_check_mark:'
    path: crates/convolution/convolution/src/arbitrary_mod.rs
    title: crates/convolution/convolution/src/arbitrary_mod.rs
  - icon: ':heavy_check_mark:'
    path: crates/convolution/convolution/src/lib.rs
    title: crates/convolution/convolution/src/lib.rs
  - icon: ':heavy_check_mark:'
    path: crates/convolution/convolution/src/naive.rs
    title: crates/convolution/convolution/src/naive.rs
  - icon: ':heavy_check_mark:'
    path: crates/convolution/convolution/src/ntt.rs
    title: crates/convolution/convolution/src/ntt.rs
  - icon: ':heavy_check_mark:'
    path: crates/convolution/convolution/src/ntt_friendly.rs
    title: crates/convolution/convolution/src/ntt_friendly.rs
  _extendedRequiredBy:
  - icon: ':heavy_check_mark:'
    path: crates/convolution/convolution/src/arbitrary_mod.rs
    title: crates/convolution/convolution/src/arbitrary_mod.rs
  - icon: ':heavy_check_mark:'
    path: crates/convolution/convolution/src/lib.rs
    title: crates/convolution/convolution/src/lib.rs
  - icon: ':heavy_check_mark:'
    path: crates/convolution/convolution/src/naive.rs
    title: crates/convolution/convolution/src/naive.rs
  - icon: ':heavy_check_mark:'
    path: crates/convolution/convolution/src/ntt.rs
    title: crates/convolution/convolution/src/ntt.rs
  - icon: ':heavy_check_mark:'
    path: crates/convolution/convolution/src/ntt_friendly.rs
    title: crates/convolution/convolution/src/ntt_friendly.rs
  - icon: ':heavy_check_mark:'
    path: crates/polynomial/formal_power_series/src/lib.rs
    title: crates/polynomial/formal_power_series/src/lib.rs
  _extendedVerifiedWith:
  - icon: ':heavy_check_mark:'
    path: verify/library_checker/convolution/convolution_mod/src/main.rs
    title: verify/library_checker/convolution/convolution_mod/src/main.rs
  - icon: ':heavy_check_mark:'
    path: verify/library_checker/convolution/convolution_mod_1000000007/src/main.rs
    title: verify/library_checker/convolution/convolution_mod_1000000007/src/main.rs
  - icon: ':heavy_check_mark:'
    path: verify/library_checker/convolution/convolution_mod_2_64/src/main.rs
    title: verify/library_checker/convolution/convolution_mod_2_64/src/main.rs
  _isVerificationFailed: false
  _pathExtension: rs
  _verificationStatusIcon: ':heavy_check_mark:'
  attributes:
    links: []
  bundledCode: "Traceback (most recent call last):\n  File \"/opt/hostedtoolcache/Python/3.13.2/x64/lib/python3.13/site-packages/onlinejudge_verify/documentation/build.py\"\
    , line 71, in _render_source_code_stat\n    bundled_code = language.bundle(stat.path,\
    \ basedir=basedir, options={'include_paths': [basedir]}).decode()\n          \
    \         ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\
    \  File \"/opt/hostedtoolcache/Python/3.13.2/x64/lib/python3.13/site-packages/onlinejudge_verify/languages/rust.py\"\
    , line 288, in bundle\n    raise NotImplementedError\nNotImplementedError\n"
  code: "use static_modint::StaticModInt;\n\nuse crate::{convolution_ntt_friendly,\
    \ inv};\n\nconst NAIVE_THRESHOLD: usize = 512; // \u96D1\n\nconst M1: u32 = 167_772_161;\n\
    const M2: u32 = 469_762_049;\nconst M3: u32 = 754_974_721;\nconst M4: u32 = 880_803_841;\n\
    const M5: u32 = 998_244_353;\ntype Fp1 = StaticModInt<M1>;\ntype Fp2 = StaticModInt<M2>;\n\
    type Fp3 = StaticModInt<M3>;\ntype Fp4 = StaticModInt<M4>;\ntype Fp5 = StaticModInt<M5>;\n\
    \nconst M1INV_FP2: Fp2 = Fp2::from_raw(inv(M1, M2));\nconst M1INV_FP3: Fp3 = Fp3::from_raw(inv(M1,\
    \ M3));\nconst M1INV_FP4: Fp4 = Fp4::from_raw(inv(M1, M4));\nconst M1INV_FP5:\
    \ Fp5 = Fp5::from_raw(inv(M1, M5));\nconst M2INV_FP3: Fp3 = Fp3::from_raw(inv(M2,\
    \ M3));\nconst M2INV_FP4: Fp4 = Fp4::from_raw(inv(M2, M4));\nconst M2INV_FP5:\
    \ Fp5 = Fp5::from_raw(inv(M2, M5));\nconst M3INV_FP4: Fp4 = Fp4::from_raw(inv(M3,\
    \ M4));\nconst M3INV_FP5: Fp5 = Fp5::from_raw(inv(M3, M5));\nconst M4INV_FP5:\
    \ Fp5 = Fp5::from_raw(inv(M4, M5));\nconst P_M1: u64 = M1 as u64;\nconst P_M1M2:\
    \ u64 = P_M1.wrapping_mul(M2 as u64);\nconst P_M1M2M3: u64 = P_M1M2.wrapping_mul(M3\
    \ as u64);\nconst P_M1M2M3M4: u64 = P_M1M2M3.wrapping_mul(M4 as u64);\n\npub fn\
    \ convolution_mod_2_64(f: &[u64], g: &[u64]) -> Vec<u64> {\n    let n = f.len();\n\
    \    let m = g.len();\n    if n.min(m) <= NAIVE_THRESHOLD {\n        return convolution_naive_mod_2_64(f,\
    \ g);\n    }\n\n    let f1 = f.iter().map(|&x| Fp1::new(x)).collect::<Vec<_>>();\n\
    \    let f2 = f.iter().map(|&x| Fp2::new(x)).collect::<Vec<_>>();\n    let f3\
    \ = f.iter().map(|&x| Fp3::new(x)).collect::<Vec<_>>();\n    let f4 = f.iter().map(|&x|\
    \ Fp4::new(x)).collect::<Vec<_>>();\n    let f5 = f.iter().map(|&x| Fp5::new(x)).collect::<Vec<_>>();\n\
    \    let g1 = g.iter().map(|&x| Fp1::new(x)).collect::<Vec<_>>();\n    let g2\
    \ = g.iter().map(|&x| Fp2::new(x)).collect::<Vec<_>>();\n    let g3 = g.iter().map(|&x|\
    \ Fp3::new(x)).collect::<Vec<_>>();\n    let g4 = g.iter().map(|&x| Fp4::new(x)).collect::<Vec<_>>();\n\
    \    let g5 = g.iter().map(|&x| Fp5::new(x)).collect::<Vec<_>>();\n    let fg1\
    \ = convolution_ntt_friendly(&f1, &g1);\n    let fg2 = convolution_ntt_friendly(&f2,\
    \ &g2);\n    let fg3 = convolution_ntt_friendly(&f3, &g3);\n    let fg4 = convolution_ntt_friendly(&f4,\
    \ &g4);\n    let fg5 = convolution_ntt_friendly(&f5, &g5);\n\n    fg1.into_iter()\n\
    \        .zip(fg2)\n        .zip(fg3)\n        .zip(fg4)\n        .zip(fg5)\n\
    \        .map(|((((e1, e2), e3), e4), e5)| {\n            let x1 = e1;\n     \
    \       let x2 = (e2 - Fp2::from_raw(x1.val())) * M1INV_FP2;\n            let\
    \ x3 =\n                ((e3 - Fp3::from_raw(x1.val())) * M1INV_FP3 - Fp3::from_raw(x2.val()))\
    \ * M2INV_FP3;\n            let x4 = (((e4 - Fp4::from_raw(x1.val())) * M1INV_FP4\
    \ - Fp4::from_raw(x2.val()))\n                * M2INV_FP4\n                - Fp4::from_raw(x3.val()))\n\
    \                * M3INV_FP4;\n            let x5 = ((((e5 - Fp5::from_raw(x1.val()))\
    \ * M1INV_FP5 - Fp5::from_raw(x2.val()))\n                * M2INV_FP5\n      \
    \          - Fp5::from_raw(x3.val()))\n                * M3INV_FP5\n         \
    \       - Fp5::from_raw(x4.val()))\n                * M4INV_FP5;\n           \
    \ (x1.val() as u64)\n                .wrapping_add((x2.val() as u64).wrapping_mul(P_M1))\n\
    \                .wrapping_add((x3.val() as u64).wrapping_mul(P_M1M2))\n     \
    \           .wrapping_add((x4.val() as u64).wrapping_mul(P_M1M2M3))\n        \
    \        .wrapping_add((x5.val() as u64).wrapping_mul(P_M1M2M3M4))\n        })\n\
    \        .collect()\n}\n\npub fn convolution_naive_mod_2_64(f: &[u64], g: &[u64])\
    \ -> Vec<u64> {\n    let n = f.len();\n    let m = g.len();\n    if n > m {\n\
    \        return convolution_naive_mod_2_64(g, f);\n    } else if n == 0 {\n  \
    \      return vec![];\n    }\n\n    let mut h = vec![0u64; n + m - 1];\n    for\
    \ i in 0..n {\n        for j in 0..m {\n            h[i + j] = h[i + j].wrapping_add(f[i].wrapping_mul(g[j]));\n\
    \        }\n    }\n    h\n}\n"
  dependsOn:
  - crates/convolution/convolution/src/arbitrary_mod.rs
  - crates/convolution/convolution/src/lib.rs
  - crates/convolution/convolution/src/naive.rs
  - crates/convolution/convolution/src/ntt.rs
  - crates/convolution/convolution/src/ntt_friendly.rs
  isVerificationFile: false
  path: crates/convolution/convolution/src/mod_2_64.rs
  requiredBy:
  - crates/polynomial/formal_power_series/src/lib.rs
  - crates/convolution/convolution/src/lib.rs
  - crates/convolution/convolution/src/arbitrary_mod.rs
  - crates/convolution/convolution/src/ntt.rs
  - crates/convolution/convolution/src/naive.rs
  - crates/convolution/convolution/src/ntt_friendly.rs
  timestamp: '2025-03-08 02:08:27+00:00'
  verificationStatus: LIBRARY_ALL_AC
  verifiedWith:
  - verify/library_checker/convolution/convolution_mod_1000000007/src/main.rs
  - verify/library_checker/convolution/convolution_mod_2_64/src/main.rs
  - verify/library_checker/convolution/convolution_mod/src/main.rs
documentation_of: crates/convolution/convolution/src/mod_2_64.rs
layout: document
redirect_from:
- /library/crates/convolution/convolution/src/mod_2_64.rs
- /library/crates/convolution/convolution/src/mod_2_64.rs.html
title: crates/convolution/convolution/src/mod_2_64.rs
---
